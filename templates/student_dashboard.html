<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <title>Student Dashboard - University of Mpumalanga</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        .bg-image {
            /* background-image: url("{{ url_for('static', filename='images/10yrs.jpg') }}"); */
            background-size: cover;
            background-position: center;
            min-height: 100vh;
            position: relative;
        }
        .bg-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .card-preview {
            width: 340px;
            height: 215px;
            background: linear-gradient(135deg, #1a365d 0%, #2a4365 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .card-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("{{ url_for('static', filename='images/ump-logo.png') }}") no-repeat center;
            opacity: 0.1;
            z-index: 0;
        }
        .card-content {
            position: relative;
            z-index: 1;
        }
        .photo-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid white;
            object-fit: cover;
        }
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-pending {
            background-color: #f59e0b;
            color: white;
        }
        .status-approved {
            background-color: #10b981;
            color: white;
        }
        .status-rejected {
            background-color: #ef4444;
            color: white;
        }
        .message {
            display: none;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .message.show {
            display: block;
        }
        .message-success {
            background-color: #d1fae5;
            border: 1px solid #a7f3d0;
            color: #059669;
        }
        .message-error {
            background-color: #fee2e2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
        .message-info {
            background-color: #dbeafe;
            border: 1px solid #bfdbfe;
            color: #2563eb;
        }

        /* Student Card Styles */
        .student-card {
            width: 85.6mm;
            height: 53.98mm;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            transform: scale(2);
            transform-origin: top left;
            margin: 20px;
            display: none;
        }

        .student-card.visible {
            display: block;
        }

        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            padding: 5px;
        }

        .card-header {
            color: #1a365d;
            padding: 5px;
            text-align: center;
            position: relative;
            height: 25%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            background: none;
        }

        .card-title {
            font-size: 10px;
            font-weight: bold;
            margin: 0 0 5px 0;
            line-height: 1.1;
            letter-spacing: 0.5px;
            color: #1a365d;
            text-align: center;
        }

        .university-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 5px 0;
        }

        .card-logo {
            width: 100px;
            height: 60px;
            display: block;
            object-fit: contain;
        }

        .campus-name {
            font-size: 9px;
            color: #ff0000;
            font-weight: bold;
            text-align: center;
            margin-top: 5px;
            letter-spacing: 0.5px;
        }

        .card-content {
            padding: 8px;
            height: 75%;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .photo-container {
            width: 90px;
            height: 90px;
            border: 1px solid #1a365d;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 5px;
            position: absolute;
            top: 8px;
            left: 8px;
        }

        .student-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .student-info {
            width: 100%;
            text-align: left;
            padding: 0;
            margin-top: 5px;
            margin-left: 0;
            padding-top: 80px;
            position: absolute;
            top: -20px;
            left: 8px;
            right: 8px;
        }

        .name-container {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .student-title {
            font-size: 8px;
            color: #000;
            font-weight: bold;
        }

        .student-name {
            font-size: 8px;
            color: #000;
            font-weight: bold;
        }

        .student-surname {
            font-size: 8px;
            color: #000;
            font-weight: bold;
        }

        .student-qualification {
            font-size: 8px;
            color: #000;
            margin-top: 5px;
        }

        .card-footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: #1a365d;
            color: white;
            padding: 3px;
            text-align: center;
            font-size: 9px;
            letter-spacing: 0.3px;
            font-weight: bold;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-code {
            position: absolute;
            bottom: 25px;
            right: 8px;
            width: 20px;
            height: 20px;
        }

        .form-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #1a365d;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 14px;
            color: #2d3748;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1a365d;
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }

        .form-group input[type="file"] {
            padding: 6px;
            background: #f7fafc;
            border: 1px dashed #cbd5e0;
            cursor: pointer;
        }

        .form-group input[type="file"]:hover {
            border-color: #1a365d;
        }

        .form-group button {
            width: 100%;
            padding: 10px;
            background: #1a365d;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-group button:hover {
            background: #2a4365;
            transform: translateY(-1px);
        }

        .form-group button:active {
            transform: translateY(0);
        }

        .card-status {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .status-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a365d;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #FEF3C7;
            color: #92400E;
        }

        .status-active {
            background: #D1FAE5;
            color: #065F46;
        }

        .status-expired {
            background: #FEE2E2;
            color: #991B1B;
        }

        .status-dates {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #E5E7EB;
        }

        .status-date {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #4B5563;
        }

        .status-date-label {
            font-weight: 500;
            color: #1F2937;
        }

        .status-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .status-button {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .view-history {
            background: #E5E7EB;
            color: #374151;
        }

        .view-history:hover {
            background: #D1D5DB;
        }

        .download-card {
            background: #1a365d;
            color: white;
        }

        .download-card:hover {
            background: #2a4365;
        }

        .button-icon {
            width: 16px;
            height: 16px;
        }

        /* Navigation styles */
        nav.bg-white {
            background-color: #767272 !important;
        }

        nav .text-gray-800 {
            color: white !important;
        }

        nav .text-gray-700 {
            color: white !important;
        }
        .year-text {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            color: #000;
            font-weight: bold;
            z-index: 10;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flashMessages" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000;">
                {% for category, message in messages %}
                    <div class="flash-message" style="background: {% if category == 'error' %}#f56565{% else %}#48bb78{% endif %}; color: white; padding: 15px 20px; margin: 5px 0; border-radius: 5px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-weight: bold; text-align: center; min-width: 300px;">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
            <script>
                // Auto-hide messages: success after 2 seconds, errors after 5 seconds
                window.onload = function() {
                    var flashMessages = document.getElementById('flashMessages');
                    if (flashMessages) {
                        var messageDivs = flashMessages.querySelectorAll('.flash-message');
                        messageDivs.forEach(function(messageDiv) {
                            var messageText = messageDiv.textContent.toLowerCase();
                            var isSuccess = messageText.includes('successfully') || 
                                           messageText.includes('detected successfully') ||
                                           messageText.includes('captured and saved');
                            
                            var timeout = isSuccess ? 2000 : 5000; // Errors now last 5 seconds
                            setTimeout(function() {
                                messageDiv.style.opacity = '0';
                                messageDiv.style.transition = 'opacity 0.5s ease-out';
                                setTimeout(function() {
                                    messageDiv.style.display = 'none';
                                }, 500);
                            }, timeout);
                        });
                    }
                };
            </script>
        {% endif %}
    {% endwith %}
    
    <div class="bg-image">
        <div class="bg-overlay"></div>
        
        <!-- Navigation -->
        <nav class="bg-white shadow-md relative z-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <img src="{{ url_for('static', filename='images/logo1.jpg') }}" alt="UMP Logo" class="h-8 w-auto">
                        <span class="ml-2 text-xl font-semibold text-gray-800">Student Portal</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="userName" class="text-gray-700">{{ session['user'] }}</span>
                        <a href="/logout" class="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors relative z-50">
                            Logout
                        </a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 py-8 relative z-10">
            <div id="messageContainer" class="message"></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-8">
                <!-- Left Column - Card Preview -->
                <div class="md:col-span-1">
                    <div class="bg-white bg-opacity-90 rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Student Card</h2>
                        <div class="flex justify-center mb-6">
                            <div class="student-card">
                                <div class="card-overlay">
                                    <span class="year-text">2025</span>
                                    <div class="photo-container">
                                        {% if card_data and card_data.photo_path %}
                                            <img id="displayPhoto" src="{{ url_for('static', filename=card_data.photo_path) }}" alt="Student Photo" class="student-photo" onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/user.jpg') }}';">
                                        {% else %}
                                            <img id="displayPhoto" src="{{ url_for('static', filename='images/user.jpg') }}" alt="Student Photo" class="student-photo">
                                        {% endif %}
                                    </div>
                                    <div class="card-header">
                                        <h1 class="card-title">STUDENT CARD</h1>
                                        <div class="university-container">
                                            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="UMP Logo" class="card-logo">
                                        </div>
                                        <div class="campus-name" id="displayCampus">{{ student_campus.upper() }}</div>
                                    </div>
                                    <div class="card-content">
                                        <div class="student-info">
                                            <div class="name-container">
                                                <span class="student-title" id="displayTitle">{{ card_data.title if card_data else 'MR' }}</span>
                                                <span class="student-name" id="displayName">{{ card_data.name if card_data else '' }}</span>
                                                <span class="student-surname" id="displaySurname">{{ card_data.surname if card_data else '' }}</span>
                                            </div>
                                            <div class="student-qualification" id="displayQualification">{{ card_data.qualification if card_data else '' }}</div>
                                        </div>
                                        <img src="{{ url_for('qr_image', email=session['user']) }}" alt="QR Code" class="qr-code">
                                    </div>
                                    <div class="card-footer">
                                        <p id="footerStudentNumber">{{ card_data.student_number if card_data and card_data.student_number else student_number }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <form id="studentCardForm" class="form-container" method="POST" action="/update-card" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="title">Title</label>
                                <select id="title" name="title" required>
                                    <option value="MR" {% if card_data and card_data.title == 'MR' %}selected{% endif %}>Mr</option>
                                    <option value="MS" {% if card_data and card_data.title == 'MS' %}selected{% endif %}>Ms</option>
                                </select>
                            </div>
                            <div class="form-group">
<label for="studentNumber">Student Number</label>
<input 
  type="text" 
  id="studentNumber" 
  name="studentNumber" 
  value="{{ student_number }}" 
  readonly 
  class="bg-gray-100 cursor-not-allowed" 
  title="Student number is derived from your UMP email"
>
                            </div>
                            <div class="form-group">
                                <label for="fullName">Full Name</label>
                                <input type="text" id="fullName" name="fullName" value="{{ card_data.name + ' ' + card_data.surname if card_data else '' }}" required>
                            </div>
                            <div class="form-group">
                                <label for="qualification">Select your qualification:</label>
                                <select id="qualification" name="qualification" required>
                                    <option value="" disabled {% if not card_data or not card_data.qualification %}selected{% endif %}>-- Choose qualification --</option>
                                    <option value="Higher Certificate in ICT (User Support)" {% if card_data and card_data.qualification == 'Higher Certificate in ICT (User Support)' %}selected{% endif %}>HICT</option>
                                    <option value="Diploma in ICT (Applications Development)" {% if card_data and card_data.qualification == 'Diploma in ICT (Applications Development)' %}selected{% endif %}>DIPICT</option>
                                    <option value="Diploma in Nature Conservation" {% if card_data and card_data.qualification == 'Diploma in Nature Conservation' %}selected{% endif %}>DIPNAT</option>
                                    <option value="Diploma in Agriculture in Plant Production" {% if card_data and card_data.qualification == 'Diploma in Agriculture in Plant Production' %}selected{% endif %}>DIPAGR</option>
                                    <option value="Diploma in Animal Production" {% if card_data and card_data.qualification == 'Diploma in Animal Production' %}selected{% endif %}>DIPANP</option>
                                    <option value="Diploma in Hospitality Management" {% if card_data and card_data.qualification == 'Diploma in Hospitality Management' %}selected{% endif %}>DIPHOS</option>
                                    <option value="Advanced Diploma in Nature Conservation" {% if card_data and card_data.qualification == 'Advanced Diploma in Nature Conservation' %}selected{% endif %}>ADPCON</option>
                                    <option value="Advanced Diploma in Agriculture (Extension)" {% if card_data and card_data.qualification == 'Advanced Diploma in Agriculture (Extension)' %}selected{% endif %}>ADPAGR</option>
                                    <option value="Postgraduate Diploma in ICT" {% if card_data and card_data.qualification == 'Postgraduate Diploma in ICT' %}selected{% endif %}>PGDICT</option>
                                    <option value="Bachelor of Information and Communication Technology" {% if card_data and card_data.qualification == 'Bachelor of Information and Communication Technology' %}selected{% endif %}>BICT</option>
                                    <option value="Bachelor of Science" {% if card_data and card_data.qualification == 'Bachelor of Science' %}selected{% endif %}>BSC</option>
                                    <option value="Bachelor of Agriculture (Extension & Rural Resource Management)" {% if card_data and card_data.qualification == 'Bachelor of Agriculture (Extension & Rural Resource Management)' %}selected{% endif %}>BAGR</option>
                                    <option value="Bachelor of Science in Forestry" {% if card_data and card_data.qualification == 'Bachelor of Science in Forestry' %}selected{% endif %}>BSCFOR</option>
                                    <option value="Bachelor of Education in Foundation Phase Teaching" {% if card_data and card_data.qualification == 'Bachelor of Education in Foundation Phase Teaching' %}selected{% endif %}>BEDF</option>
                                    <option value="Bachelor of Commerce" {% if card_data and card_data.qualification == 'Bachelor of Commerce' %}selected{% endif %}>BCOM</option>
                                    <option value="Bachelor of Laws" {% if card_data and card_data.qualification == 'Bachelor of Laws' %}selected{% endif %}>LLB</option>
                                    <option value="Bachelor of Social Work" {% if card_data and card_data.qualification == 'Bachelor of Social Work' %}selected{% endif %}>BSW</option>
                                    <option value="Honours / Master / PhD (specify)" {% if card_data and card_data.qualification == 'Honours / Master / PhD (specify)' %}selected{% endif %}>HONS/MAST/PHD</option>
                                </select>

                               
                            </div>
                            <div class="form-group">
                                <label for="campus">Campus</label>
                                <select id="campus" name="campus" required>
                                    <option value="Mbombela Campus" {% if student_campus == 'Mbombela Campus' %}selected{% endif %}>Mbombela Campus</option>
                                    <option value="Siyabuswa Campus" {% if student_campus == 'Siyabuswa Campus' %}selected{% endif %}>Siyabuswa Campus</option>
                                </select>
                                <small style="color: #1a365d; font-size: 0.8em;">Choose the campus where you are registered.</small>
                            </div>

                            <div class="form-group">
                                {% if card_data and card_data.proof_of_registration_path %}
                                    <!-- Proof of Registration Verified -->
                                    <div style="background-color: #d1fae5; border: 2px solid #10b981; border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                            <svg style="width: 24px; height: 24px; color: #10b981;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <strong style="color: #065f46; font-size: 1em;">Proof of Registration Verified</strong>
                                        </div>
                                        <div style="color: #065f46; font-size: 0.95em;">
                                            <strong>Valid Until:</strong> 31/12/2025
                                        </div>
                                    </div>
                                {% else %}
                                    <!-- Note for proof of registration upload -->
                                    <div style="font-size: 0.9em; color: #e53e3e; margin-bottom: 5px;">
                                        <strong>Proof of Registration Requirements (MANDATORY for Students):</strong><br>
                                        • Must be a valid PDF file<br>
                                        • Should be a clear, readable document<br>
                                        • <strong>Required for card verification and approval</strong>
                                    </div>
                                    <label for="proof_of_registration">Proof of Registration (PDF) *</label>
                                    <input type="file" id="proof_of_registration" name="proof_of_registration" accept="application/pdf" {% if not card_data %}required{% endif %}>
                                    <small style="color: #e53e3e; font-size: 0.8em;">* Required for student card creation and verification</small>
                                {% endif %}
                            </div>

                            <div class="form-group">
                                {% if card_data and card_data.photo_path %}
                                    <!-- Face Photo Verified -->
                                    <div style="background-color: #d1fae5; border: 2px solid #10b981; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                            <svg style="width: 24px; height: 24px; color: #10b981;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <strong style="color: #065f46; font-size: 1em;">Face Photo Verified Successfully</strong>
                                        </div>
                                        <div style="margin-top: 10px;">
                                            <button type="button" onclick="showPhotoUpload()" style="background-color: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; transition: background-color 0.3s;" onmouseover="this.style.backgroundColor='#059669'" onmouseout="this.style.backgroundColor='#10b981'">
                                                Replace Current Photo
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Photo Upload Options (Hidden by default when photo is verified) -->
                                    <div id="photo-upload-section" style="display: none;">
                                        <div style="font-size: 0.9em; color: #e53e3e; margin-bottom: 5px;">
                                            <strong>Photo Requirements:</strong><br>
                                            • Make sure your face is clearly visible and facing forward<br>
                                            • Supported formats: JPG, PNG, GIF
                                        </div>
                                        
                                        <!-- Photo Upload Method Selection -->
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 10px; font-weight: bold;">Choose Photo Method:</label>
                                            <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                                                <label style="display: flex; align-items: center; cursor: pointer;">
                                                    <input type="radio" name="photo_method" value="upload" checked style="margin-right: 8px;">
                                                    Upload Photo
                                                </label>
                                                <label style="display: flex; align-items: center; cursor: pointer;">
                                                    <input type="radio" name="photo_method" value="live" style="margin-right: 8px;">
                                                    Take Live Photo
                                                </label>
                                            </div>
                                        </div>

                                        <!-- Upload Photo Option -->
                                        <div id="upload-section">
                                            <label for="photo">Upload Photo</label>
                                            <input type="file" id="photo" name="photo" accept="image/*">
                                        </div>

                                        <!-- Live Photo Option -->
                                        <div id="live-section" style="display: none;">
                                            <label>Live Photo Capture</label>
                                            <div style="border: 2px dashed #ccc; padding: 20px; text-align: center; border-radius: 8px; background: #f9f9f9;">
                                                <video id="video" width="320" height="240" autoplay style="display: none; border-radius: 8px;"></video>
                                                <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
                                                <div id="live-photo-placeholder">
                                                    <p style="margin-bottom: 15px; color: #666;">Click "Start Camera" to take a live photo</p>
                                                    <div id="face-status" style="margin-bottom: 15px; font-weight: bold; color: #ff9800;">Position your face in the frame</div>
                                                    <button type="button" id="start-camera" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Start Camera</button>
                                                    <button type="button" id="capture-photo" style="background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; display: none;">Capture Photo</button>
                                                    <button type="button" id="retake-photo" style="background: #ff9800; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; display: none;">Retake</button>
                                                </div>
                                                <div id="captured-photo" style="display: none;">
                                                    <img id="captured-image" style="max-width: 320px; max-height: 240px; border-radius: 8px; margin-bottom: 10px;">
                                                    <p id="capture-status" style="color: #4CAF50; font-weight: bold;">Photo captured successfully!</p>
                                                    <div id="auto-save-indicator" style="display: none; margin-top: 10px;">
                                                        <div style="display: flex; align-items: center; justify-content: center; color: #2196F3;">
                                                            <div style="width: 20px; height: 20px; border: 2px solid #2196F3; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                                                            <span>Auto-saving your details...</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <input type="hidden" id="live-photo-data" name="live_photo_data">
                                        </div>
                                    </div>
                                {% else %}
                                    <!-- Photo Upload Options (Shown when no photo exists) -->
                                    <div style="font-size: 0.9em; color: #e53e3e; margin-bottom: 5px;">
                                        <strong>Photo Requirements:</strong><br>
                                        • Make sure your face is clearly visible and facing forward<br>
                                        • Supported formats: JPG, PNG, GIF
                                    </div>
                                    
                                    <!-- Photo Upload Method Selection -->
                                    <div style="margin-bottom: 15px;">
                                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">Choose Photo Method:</label>
                                        <div style="display: flex; gap: 20px; margin-bottom: 15px;">
                                            <label style="display: flex; align-items: center; cursor: pointer;">
                                                <input type="radio" name="photo_method" value="upload" checked style="margin-right: 8px;">
                                                Upload Photo
                                            </label>
                                            <label style="display: flex; align-items: center; cursor: pointer;">
                                                <input type="radio" name="photo_method" value="live" style="margin-right: 8px;">
                                                Take Live Photo
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Upload Photo Option -->
                                    <div id="upload-section">
                                        <label for="photo">Upload Photo</label>
                                        <input type="file" id="photo" name="photo" accept="image/*" required>
                                    </div>

                                    <!-- Live Photo Option -->
                                    <div id="live-section" style="display: none;">
                                        <label>Live Photo Capture</label>
                                        <div style="border: 2px dashed #ccc; padding: 20px; text-align: center; border-radius: 8px; background: #f9f9f9;">
                                            <video id="video" width="320" height="240" autoplay style="display: none; border-radius: 8px;"></video>
                                            <canvas id="canvas" width="320" height="240" style="display: none;"></canvas>
                                            <div id="live-photo-placeholder">
                                                <p style="margin-bottom: 15px; color: #666;">Click "Start Camera" to take a live photo</p>
                                                <div id="face-status" style="margin-bottom: 15px; font-weight: bold; color: #ff9800;">Position your face in the frame</div>
                                                <button type="button" id="start-camera" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Start Camera</button>
                                                <button type="button" id="capture-photo" style="background: #2196F3; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; display: none;">Capture Photo</button>
                                                <button type="button" id="retake-photo" style="background: #ff9800; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; display: none;">Retake</button>
                                            </div>
                                            <div id="captured-photo" style="display: none;">
                                                <img id="captured-image" style="max-width: 320px; max-height: 240px; border-radius: 8px; margin-bottom: 10px;">
                                                <p id="capture-status" style="color: #4CAF50; font-weight: bold;">Photo captured successfully!</p>
                                                <div id="auto-save-indicator" style="display: none; margin-top: 10px;">
                                                    <div style="display: flex; align-items: center; justify-content: center; color: #2196F3;">
                                                        <div style="width: 20px; height: 20px; border: 2px solid #2196F3; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                                                        <span>Auto-saving your details...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <input type="hidden" id="live-photo-data" name="live_photo_data">
                                    </div>
                                {% endif %}
                            </div>
                           
                            <div class="form-group">
                                <button type="submit">Update Card</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Middle Column - Card Status -->
                <div class="md:col-span-1">
                    <div class="card-status">
                        <div class="status-header">
                            <h3 class="status-title">Card Status</h3>
                            <span class="status-badge status-active">Active</span>
                        </div>
                        <div class="status-dates">
                            <div class="status-date">
                                <span class="status-date-label">Last Updated:</span>
                                <span id="lastUpdatedDate"></span>
                            </div>
                            <div class="status-date">
                                <span class="status-date-label">Valid Until:</span>
                                <span>31/12/2025</span>
                            </div>
                        </div>
                        <div class="status-actions">
                            <a href="#" class="status-button view-history">
                                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                View History
                            </a>
                            <a href="#" class="status-button download-card" onclick="downloadCard()">
                                <svg class="button-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                Download Card
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Quick Actions -->
                <div class="md:col-span-1">
                    <div class="bg-white bg-opacity-90 rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Quick Actions</h2>
                        <div class="space-y-4">
                            <a href="#" onclick="previewCard()" class="w-full bg-gray-100 text-gray-800 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-start">
                                Preview Card
                            </a>
                            <a href="/submit-ticket" class="w-full bg-gray-100 text-gray-800 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-start">
                                Report Problem
                            </a>
                            <a href="/security-settings" class="w-full bg-gray-100 text-gray-800 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-start">
                                Update Security Questions
                            </a>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configure axios defaults
        axios.defaults.withCredentials = true;
        axios.defaults.headers.common['Content-Type'] = 'application/json';
        axios.defaults.headers.common['Accept'] = 'application/json';

        // Check authentication status
        async function checkAuth() {
            try {
                const response = await axios.get('/api/check-auth');
                if (!response.data.authenticated) {
                    window.location.href = '/login';
                    return;
                }
                // Load card status if authenticated
                loadCardStatus();
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = '/login';
            }
        }

        // Load card status
        async function loadCardStatus() {
            try {
                const response = await axios.get('/api/card-status');
                const cardStatus = response.data.card_status;
                const statusElement = document.getElementById('cardStatus');
                
                if (cardStatus === 'active') {
                    statusElement.textContent = 'Active';
                    statusElement.classList.add('text-green-600');
                } else {
                    statusElement.textContent = 'Inactive';
                    statusElement.classList.add('text-red-600');
                }
            } catch (error) {
                console.error('Failed to load card status:', error);
                if (error.response && error.response.status === 401) {
                    window.location.href = '/login';
                }
            }
        }

        function showMessage(message, type = 'info') {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message message-${type} show`;
            
            // Hide message after 2 seconds for success messages, 3 seconds for others
            const timeout = type === 'success' ? 2000 : 3000;
            setTimeout(() => {
                messageContainer.classList.remove('show');
            }, timeout);
        }

        // Request new card
        async function requestNewCard() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('photo', file);

                try {
                    const response = await axios.post('/api/request-card', formData);
                    showMessage('Card request submitted successfully!', 'success');
                    loadCardStatus();
                } catch (error) {
                    console.error('Failed to submit card request:', error);
                    showMessage(error.response?.data?.error || 'Failed to submit card request', 'error');
                }
            };

            fileInput.click();
        }

        // Update photo
        function updatePhoto() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            
            fileInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const formData = new FormData();
                formData.append('photo', file);

                try {
                    const response = await axios.post('/api/update-photo', formData);
                    showMessage('Photo updated successfully!', 'success');
                    loadCardStatus();
                } catch (error) {
                    console.error('Failed to update photo:', error);
                    showMessage(error.response?.data?.error || 'Failed to update photo', 'error');
                }
            };

            fileInput.click();
        }

        // Report lost card
        async function reportLost() {
            if (confirm('Are you sure you want to report your card as lost?')) {
                try {
                    const response = await axios.post('/api/report-lost');
                    showMessage('Card reported as lost. A new card request will be created.', 'success');
                    loadCardStatus();
                } catch (error) {
                    console.error('Failed to report lost card:', error);
                    showMessage(error.response?.data?.error || 'Failed to report lost card', 'error');
                }
            }
        }

        // View history
        async function viewHistory() {
            try {
                const response = await axios.get('/api/card-history');
                showMessage('History feature coming soon!', 'info');
            } catch (error) {
                console.error('Failed to load history:', error);
                showMessage(error.response?.data?.error || 'Failed to load history', 'error');
            }
        }

        // Download card function
        function downloadCard() {
            const downloadUrl = '/student-card-preview?download=1';
            const win = window.open(downloadUrl, '_blank');
            if (!win) {
                window.location.href = downloadUrl;
            }
        }

        // Logout function
        async function logout() {
            try {
                await axios.post('/api/logout');
                sessionStorage.removeItem('user');
                window.location.href = '/login';
            } catch (error) {
                console.error('Logout failed:', error);
                // Still redirect to login page even if logout fails
                sessionStorage.removeItem('user');
                window.location.href = '/login';
            }
        }

        // Check auth when page loads
        document.addEventListener('DOMContentLoaded', checkAuth);

        // Student Card Form Handler
        document.getElementById('studentCardForm').addEventListener('submit', function(e) {
            // Form will be submitted to /update-card via POST
            // No need for JavaScript handling as it's handled server-side
        });

        // Update last updated date when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const lastUpdated = now.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            document.getElementById('lastUpdatedDate').textContent = lastUpdated;
        });

        // Preview card function
        async function previewCard() {
            try {
                // Get the current card data from the dashboard
                const card = document.querySelector('.student-card');
                if (!card) {
                    showMessage('No card data available', 'error');
                    return;
                }

                // Get data from the current card display
                const title = document.getElementById('displayTitle').textContent.trim();
                const name = document.getElementById('displayName').textContent.trim();
                const surname = document.getElementById('displaySurname').textContent.trim();
                const qualification = document.getElementById('displayQualification').textContent.trim();
                const studentNumber = document.getElementById('footerStudentNumber').textContent.trim();
                const photo = document.getElementById('displayPhoto').src;

                console.log('Card Data:', {
                    title,
                    name,
                    surname,
                    qualification,
                    studentNumber,
                    photo
                });

                // Store data in sessionStorage
                sessionStorage.setItem('cardTitle', title);
                sessionStorage.setItem('cardName', name);
                sessionStorage.setItem('cardSurname', surname);
                sessionStorage.setItem('cardQualification', qualification);
                sessionStorage.setItem('cardStudentNumber', studentNumber);
                sessionStorage.setItem('cardPhoto', photo);

                // Verify data was stored
                console.log('Stored Data:', {
                    title: sessionStorage.getItem('cardTitle'),
                    name: sessionStorage.getItem('cardName'),
                    surname: sessionStorage.getItem('cardSurname'),
                    qualification: sessionStorage.getItem('cardQualification'),
                    studentNumber: sessionStorage.getItem('cardStudentNumber'),
                    photo: sessionStorage.getItem('cardPhoto')
                });

                // Redirect to preview page
                window.location.href = '/student-card-preview';
            } catch (error) {
                console.error('Failed to load card data:', error);
                showMessage('Failed to load card data', 'error');
            }
        }

        // Load card data when page loads
        async function loadCardData() {
            try {
                const response = await axios.get('/api/card-status');
                const cardData = response.data;
                
                // Update card display
                document.getElementById('displayTitle').textContent = cardData.title || 'MR';
                document.getElementById('displayName').textContent = cardData.name || '';
                document.getElementById('displaySurname').textContent = cardData.surname || '';
                document.getElementById('displayQualification').textContent = cardData.qualification || '';
                document.getElementById('footerStudentNumber').textContent = cardData.studentNumber || '';
                if (cardData.photo) {
                    document.getElementById('displayPhoto').src = cardData.photo;
                }
            } catch (error) {
                console.error('Failed to load card data:', error);
            }
        }

        // Call loadCardData when page loads
        document.addEventListener('DOMContentLoaded', loadCardData);

        // Report problem function
        async function reportProblem() {
            try {
                const response = await axios.post('/api/report-problem');
                showMessage('Problem reported successfully!', 'success');
            } catch (error) {
                console.error('Failed to report problem:', error);
                showMessage('Failed to report problem', 'error');
            }
        }

        // Register attendance function
        async function registerAttendance() {
            try {
                const response = await axios.post('/api/register-attendance');
                showMessage('Attendance registered successfully!', 'success');
            } catch (error) {
                console.error('Failed to register attendance:', error);
                showMessage('Failed to register attendance', 'error');
            }
        }

        // Live Photo Capture Functionality with Auto-Detection
        let stream = null;
        let video = null;
        let canvas = null;
        let capturedImageData = null;
        let faceDetectionInterval = null;
        let faceDetected = false;
        let countdownTimer = null;
        let countdownSeconds = 3;
        let autoSaveCountdown = null;

        // Initialize live photo functionality when page loads
        document.addEventListener('DOMContentLoaded', function() {
            video = document.getElementById('video');
            canvas = document.getElementById('canvas');
            const campusSelect = document.getElementById('campus');
            if (campusSelect) {
                campusSelect.addEventListener('change', function() {
                    const displayCampus = document.getElementById('displayCampus');
                    if (displayCampus) {
                        displayCampus.textContent = this.value.toUpperCase();
                    }
                });
            }
            
            // Handle photo method selection
            const photoMethodRadios = document.querySelectorAll('input[name="photo_method"]');
            const uploadSection = document.getElementById('upload-section');
            const liveSection = document.getElementById('live-section');
            
            photoMethodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'upload') {
                        uploadSection.style.display = 'block';
                        liveSection.style.display = 'none';
                        stopCamera();
                    } else if (this.value === 'live') {
                        uploadSection.style.display = 'none';
                        liveSection.style.display = 'block';
                    }
                });
            });

            // Camera controls
            document.getElementById('start-camera').addEventListener('click', startCamera);
            document.getElementById('capture-photo').addEventListener('click', capturePhoto);
            document.getElementById('retake-photo').addEventListener('click', retakePhoto);
        });

        async function startCamera() {
            try {
                // Request camera access
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 320, 
                        height: 240,
                        facingMode: 'user' // Front camera
                    } 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                
                // Show/hide buttons
                document.getElementById('live-photo-placeholder').style.display = 'none';
                document.getElementById('capture-photo').style.display = 'inline-block';
                document.getElementById('start-camera').style.display = 'none';
                
                // Start face detection
                startFaceDetection();
                
                showMessage('Camera started! Position your face in the frame - photo will be taken automatically when face is detected!', 'success');
            } catch (error) {
                console.error('Error accessing camera:', error);
                showMessage('Error accessing camera. Please ensure camera permissions are granted.', 'error');
            }
        }

        function startFaceDetection() {
            // Simple face detection using canvas analysis
            faceDetectionInterval = setInterval(() => {
                if (video && video.readyState === video.HAVE_ENOUGH_DATA) {
                    detectFace();
                }
            }, 100); // Check every 100ms
        }

        function detectFace() {
            if (!video || !canvas) return;
            
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, 320, 240);
            
            const imageData = context.getImageData(0, 0, 320, 240);
            const data = imageData.data;
            
            // Simple face detection based on skin tone detection
            let skinPixels = 0;
            let totalPixels = 0;
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Simple skin tone detection
                if (r > 95 && g > 40 && b > 20 && 
                    Math.max(r, g, b) - Math.min(r, g, b) > 15 && 
                    Math.abs(r - g) > 15 && r > g && r > b) {
                    skinPixels++;
                }
                totalPixels++;
            }
            
            const skinPercentage = (skinPixels / totalPixels) * 100;
            
            // Update face detection status
            const statusElement = document.getElementById('face-status');
            if (skinPercentage > 5) { // Threshold for face detection
                if (!faceDetected) {
                    faceDetected = true;
                    if (statusElement) {
                        statusElement.textContent = 'Face detected! Get ready...';
                        statusElement.style.color = '#4CAF50';
                    }
                    startCountdown();
                }
            } else {
                if (faceDetected) {
                    faceDetected = false;
                    if (statusElement) {
                        statusElement.textContent = 'Position your face in the frame';
                        statusElement.style.color = '#ff9800';
                    }
                    clearCountdown();
                }
            }
        }

        function startCountdown() {
            if (countdownTimer) return; // Already counting down
            
            countdownSeconds = 3;
            const statusElement = document.getElementById('face-status');
            
            countdownTimer = setInterval(() => {
                if (statusElement) {
                    statusElement.textContent = `Capturing in ${countdownSeconds}...`;
                    statusElement.style.color = '#2196F3';
                }
                
                countdownSeconds--;
                
                if (countdownSeconds < 0) {
                    clearCountdown();
                    capturePhoto();
                }
            }, 1000);
        }

        function clearCountdown() {
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
        }

        function capturePhoto() {
            if (!video || !canvas) return;
            
            // Stop face detection
            if (faceDetectionInterval) {
                clearInterval(faceDetectionInterval);
                faceDetectionInterval = null;
            }
            
            const context = canvas.getContext('2d');
            
            // Draw the current video frame to canvas
            context.drawImage(video, 0, 0, 320, 240);
            
            // Convert canvas to base64 image data
            capturedImageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Show captured image
            const capturedImage = document.getElementById('captured-image');
            capturedImage.src = capturedImageData;
            
            // Show/hide elements
            document.getElementById('captured-photo').style.display = 'block';
            document.getElementById('capture-photo').style.display = 'none';
            document.getElementById('retake-photo').style.display = 'inline-block';
            
            // Store the image data in hidden input
            document.getElementById('live-photo-data').value = capturedImageData;
            
            // Stop camera
            stopCamera();
            
            showMessage('Photo captured successfully! You can now save the photo manually or wait for auto-save.', 'success');
            
            // Show manual save option
            document.getElementById('capture-status').textContent = 'Photo captured! Click "Save Photo" to save manually.';
            
            // Show manual save button
            const capturedPhoto = document.getElementById('captured-photo');
            if (!document.getElementById('manual-save-btn')) {
                const manualSaveBtn = document.createElement('button');
                manualSaveBtn.type = 'button';
                manualSaveBtn.id = 'manual-save-btn';
                manualSaveBtn.textContent = 'Save Photo Now';
                manualSaveBtn.style.cssText = 'background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;';
                manualSaveBtn.onclick = function() {
                    console.log('Manual save clicked');
                    // Clear auto-save countdown
                    if (autoSaveCountdown) {
                        clearInterval(autoSaveCountdown);
                        autoSaveCountdown = null;
                    }
                    document.getElementById('capture-status').textContent = 'Saving now...';
                    autoSubmitForm();
                };
                capturedPhoto.appendChild(manualSaveBtn);
            }
            
            // Start countdown for auto-save
            let countdown = 5;
            autoSaveCountdown = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    document.getElementById('capture-status').textContent = `Photo captured! Auto-saving photo in ${countdown} seconds...`;
                } else {
                    clearInterval(autoSaveCountdown);
                    document.getElementById('capture-status').textContent = 'Auto-saving photo now...';
                    autoSubmitForm();
                }
            }, 1000);
        }

        function autoSubmitForm() {
            console.log('autoSubmitForm called - saving photo only');
            
            // Get the form
            const form = document.getElementById('studentCardForm');
            if (!form) {
                console.log('Form not found!');
                showMessage('Form not found. Please submit manually.', 'error');
                return;
            }
            
            // Get the live photo data
            const livePhotoData = document.getElementById('live-photo-data').value;
            if (!livePhotoData) {
                console.log('No live photo data found!');
                showMessage('No photo to save. Please take a photo first.', 'error');
                return;
            }
            
            // Create a new form just for photo upload
            const photoForm = document.createElement('form');
            photoForm.method = 'POST';
            photoForm.action = '/update-card';
            photoForm.enctype = 'multipart/form-data';
            photoForm.style.display = 'none';
            
            // Add only the live photo data
            const photoInput = document.createElement('input');
            photoInput.type = 'hidden';
            photoInput.name = 'live_photo_data';
            photoInput.value = livePhotoData;
            photoForm.appendChild(photoInput);
            
            // Add to page and submit
            document.body.appendChild(photoForm);
            console.log('Submitting photo only...');
            photoForm.submit();
        }

        function retakePhoto() {
            // Reset UI
            document.getElementById('captured-photo').style.display = 'none';
            document.getElementById('retake-photo').style.display = 'none';
            document.getElementById('live-photo-placeholder').style.display = 'block';
            document.getElementById('start-camera').style.display = 'inline-block';
            
            // Clear captured data
            capturedImageData = null;
            document.getElementById('live-photo-data').value = '';
            
            // Reset face detection state
            faceDetected = false;
            clearCountdown();
            
            // Restart camera
            startCamera();
        }

        function stopCamera() {
            // Stop face detection
            if (faceDetectionInterval) {
                clearInterval(faceDetectionInterval);
                faceDetectionInterval = null;
            }
            
            // Clear countdown
            clearCountdown();
            
            // Reset face detection state
            faceDetected = false;
            
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            if (video) {
                video.srcObject = null;
                video.style.display = 'none';
            }
        }

        // Clean up camera when page unloads
        window.addEventListener('beforeunload', stopCamera);

        // Function to show photo upload section when user wants to replace photo
        function showPhotoUpload() {
            const photoUploadSection = document.getElementById('photo-upload-section');
            if (photoUploadSection) {
                photoUploadSection.style.display = 'block';
                // Scroll to the photo upload section
                photoUploadSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
    </script>
</body>
</html> 